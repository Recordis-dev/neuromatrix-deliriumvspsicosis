<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCYMED REHAB MATRIX</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        // Mapeo manual de iconos de Lucide para modo CDN
        const ShieldAlert = () => <i data-lucide="shield-alert"></i>;
        const RefreshCw = () => <i data-lucide="refresh-cw"></i>;
        const Info = () => <i data-lucide="info"></i>;
        const XCircle = () => <i data-lucide="x-circle"></i>;
        const CheckCircle2 = () => <i data-lucide="check-circle-2"></i>;
        const Activity = () => <i data-lucide="activity"></i>;
        const AlertTriangle = () => <i data-lucide="alert-triangle"></i>;

        const App = () => {
            const [currentStep, setCurrentStep] = useState(0);
            const [results, setResults] = useState({});
            const [view, setView] = useState('swipe');

            useEffect(() => {
                // Inicializar iconos después de cada render
                lucide.createIcons();
            });

            const diagnosticCards = [
                { id: 'consciousness', label: 'Nivel de Conciencia', question: '¿Hay fluctuación del nivel de conciencia o desorientación?', tags: ['Delirium'], hint: 'El delirium fluctúa; la psicosis funcional suele ser clara.' },
                { id: 'onset', label: 'Inicio del Cuadro', question: '¿Inicio abrupto (horas/días) por consumo o abstinencia?', tags: ['Sustancias'], hint: 'Tusi/Cristal causan cuadros agudos.' },
                { id: 'vitals', label: 'Signos Vitales', question: '¿Taquicardia, fiebre, midriasis o diaforesis?', tags: ['Autonómico'], hint: 'Indica toxicidad o Síndrome Neuroléptico Maligno.' },
                { id: 'hallucinations', label: 'Tipo de Alucinación', question: '¿Alucinaciones principalmente VISUALES o táctiles?', tags: ['Orgánico'], hint: 'Visuales sugieren causa orgánica/tóxica.' }
            ];

            const handleResponse = (id, value) => {
                const newResults = { ...results, [id]: value };
                setResults(newResults);
                if (currentStep < diagnosticCards.length - 1) {
                    setCurrentStep(prev => prev + 1);
                } else {
                    setView('matrix');
                }
            };

            const calculateDiagnosis = () => {
                const { consciousness, onset, vitals } = results;
                if (consciousness && vitals) return "DELIRIUM MIXTO (TÓXICO-METABÓLICO)";
                if (onset && !consciousness) return "BROTE PSICÓTICO POR SUSTANCIAS";
                if (!onset && !vitals) return "ESQUIZOFRENIA / PSICOSIS CRÓNICA";
                return "CUADRO INDETERMINADO";
            };

            const getCriticalPath = () => {
                const diag = calculateDiagnosis();
                return diag.includes("DELIRIUM") 
                    ? { tx: "Sostén, Hidratación, BZD si es abstinencia.", danger: "Evitar Quetiapina si hay sospecha anticolinérgica." }
                    : { tx: "Olanzapina 10mg o Quetiapina 200mg.", danger: "Cuidado: Tusi + BZD = Depresión respiratoria." };
            };

            return (
                <div className="min-h-screen text-slate-100 font-sans p-4 md:p-8">
                    <header className="max-w-4xl mx-auto mb-8 flex justify-between items-center border-b border-slate-700 pb-4">
                        <div>
                            <h1 className="text-2xl font-bold text-orange-500 flex items-center gap-2">
                                <ShieldAlert /> SCYMED REHAB MATRIX
                            </h1>
                        </div>
                        <button onClick={() => {setCurrentStep(0); setView('swipe'); setResults({});}} className="p-2 hover:bg-slate-800 rounded-full">
                            <RefreshCw />
                        </button>
                    </header>

                    <main className="max-w-4xl mx-auto">
                        {view === 'swipe' ? (
                            <div className="flex flex-col items-center">
                                <div className="w-full max-w-md bg-slate-800 rounded-3xl overflow-hidden shadow-2xl border border-slate-700">
                                    <div className="p-8">
                                        <h2 className="text-3xl font-semibold mb-2">{diagnosticCards[currentStep].label}</h2>
                                        <p className="text-xl text-slate-300 mb-8">{diagnosticCards[currentStep].question}</p>
                                        <div className="bg-blue-900/20 border-l-4 border-blue-500 p-4 mb-8 text-sm italic">
                                            {diagnosticCards[currentStep].hint}
                                        </div>
                                    </div>
